{% macro renderNavItem(entry, currentUrl) %}
  {% set isActive = (entry.url | isActiveLink(currentUrl)) %}
  {% set isParentActive = false %}
  {% for child in entry.children %}
    {% if child.url | isActiveLink(currentUrl) %}
      {% set isParentActive = true %}
    {% endif %}
  {% endfor %}

  <li class="eds-left-nav-item {% if isActive or isParentActive %}is-active{% endif %}">
    <a 
      href="{{ entry.url }}" 
      class="eds-left-nav-link {% if isActive %}is-current{% endif %} {% if isParentActive %}has-active-child{% endif %}"
      {% if entry.title %}aria-label="{{ entry.title }}"{% endif %}
      {% if entry.children.length %}data-has-children="true"{% endif %}
    >
      {% if entry.icon %}
        <span class="eds-left-nav-icon">{{ entry.icon | safe }}</span>
      {% endif %}
      <span class="eds-left-nav-text">{{ entry.title }}</span>
      {% if entry.children.length %}
        <span class="eds-left-nav-expand">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </span>
      {% endif %}
    </a>

    {% if entry.children.length %}
      <ul class="eds-left-nav-submenu {% if isActive or isParentActive %}is-expanded{% endif %}">
        {% for child in entry.children %}
          {{ renderNavItem(child, currentUrl) }}
        {% endfor %}
      </ul>
    {% endif %}
  </li>
{% endmacro %}

<nav class="eds-left-navigation" id="leftNavigation" aria-label="Main Navigation">
  <div class="eds-left-nav-header">
    <a href="/" class="eds-left-nav-logo">
      <svg class="eds-logo" width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="40" height="40" rx="8" fill="var(--color-primary)" />
        <path d="M10 12H30V16H10V12Z" fill="white" />
        <path d="M10 18H22V22H10V18Z" fill="white" />
        <path d="M10 24H30V28H10V24Z" fill="white" />
      </svg>
      <span>Enterprise Design System</span>
    </a>
    <button class="eds-left-nav-toggle" aria-label="Toggle navigation" aria-controls="leftNavigation" aria-expanded="false">
      <span class="eds-left-nav-toggle-icon"></span>
    </button>
  </div>

  <div class="eds-left-nav-search">
    <form action="/search/" method="get" role="search">
      <label for="leftNavSearch" class="sr-only">Search documentation</label>
      <div class="eds-search-input-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <input 
          type="search" 
          id="leftNavSearch" 
          name="q" 
          placeholder="Search documentation"
          class="eds-search-input"
        >
      </div>
    </form>
  </div>

  <div class="eds-left-nav-body">
    <ul class="eds-left-nav-menu">
      <li class="eds-left-nav-section">
        <span class="eds-left-nav-section-title">Getting Started</span>
        <ul class="eds-left-nav-section-items">
          {% set navPages = collections.all | eleventyNavigation %}
          {% for entry in navPages %}
            {% if entry.key == "Getting Started" %}
              {{ renderNavItem(entry, page.url) }}
            {% endif %}
          {% endfor %}
        </ul>
      </li>

      <li class="eds-left-nav-section">
        <span class="eds-left-nav-section-title">Design System</span>
        <ul class="eds-left-nav-section-items">
          {% for entry in navPages %}
            {% if entry.key == "Design System" %}
              {{ renderNavItem(entry, page.url) }}
            {% endif %}
          {% endfor %}
        </ul>
      </li>

      <li class="eds-left-nav-section">
        <span class="eds-left-nav-section-title">Components</span>
        <ul class="eds-left-nav-section-items">
          {% for entry in navPages %}
            {% if entry.key == "Components" %}
              {{ renderNavItem(entry, page.url) }}
            {% endif %}
          {% endfor %}

          <li class="eds-left-nav-item">
            <a href="/components/layout/" class="eds-left-nav-link {% if '/components/layout/' | isActiveLink(page.url) %}is-current{% endif %}">
              <span class="eds-left-nav-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
                </svg>
              </span>
              <span class="eds-left-nav-text">Layout Components</span>
              <span class="eds-left-nav-expand">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </span>
            </a>
            <ul class="eds-left-nav-submenu {% if '/components/layout/' | isActiveLink(page.url) %}is-expanded{% endif %}">
              <li class="eds-left-nav-item">
                <a href="/components/layout/accordion/" class="eds-left-nav-link {% if '/components/layout/accordion/' | isActiveLink(page.url) %}is-current{% endif %}">
                  <span class="eds-left-nav-text">Accordion</span>
                </a>
              </li>
              <li class="eds-left-nav-item">
                <a href="/components/layout/card/" class="eds-left-nav-link {% if '/components/layout/card/' | isActiveLink(page.url) %}is-current{% endif %}">
                  <span class="eds-left-nav-text">Card</span>
                </a>
              </li>
            </ul>
          </li>

          <li class="eds-left-nav-item">
            <a href="/components/inputs/" class="eds-left-nav-link {% if '/components/inputs/' | isActiveLink(page.url) %}is-current{% endif %}">
              <span class="eds-left-nav-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
              </span>
              <span class="eds-left-nav-text">Input Components</span>
              <span class="eds-left-nav-expand">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </span>
            </a>
            <ul class="eds-left-nav-submenu {% if '/components/inputs/' | isActiveLink(page.url) %}is-expanded{% endif %}">
              <li class="eds-left-nav-item">
                <a href="/components/inputs/button/" class="eds-left-nav-link {% if '/components/inputs/button/' | isActiveLink(page.url) %}is-current{% endif %}">
                  <span class="eds-left-nav-text">Button</span>
                </a>
              </li>
            </ul>
          </li>

          <li class="eds-left-nav-item">
            <a href="/components/navigation/" class="eds-left-nav-link {% if '/components/navigation/' | isActiveLink(page.url) %}is-current{% endif %}">
              <span class="eds-left-nav-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </span>
              <span class="eds-left-nav-text">Navigation Components</span>
              <span class="eds-left-nav-expand">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </span>
            </a>
            <ul class="eds-left-nav-submenu {% if '/components/navigation/' | isActiveLink(page.url) %}is-expanded{% endif %}">
              <li class="eds-left-nav-item">
                <a href="/components/navigation/breadcrumb/" class="eds-left-nav-link {% if '/components/navigation/breadcrumb/' | isActiveLink(page.url) %}is-current{% endif %}">
                  <span class="eds-left-nav-text">Breadcrumb</span>
                </a>
              </li>
            </ul>
          </li>

          <li class="eds-left-nav-item">
            <a href="/components/feedback/" class="eds-left-nav-link {% if '/components/feedback/' | isActiveLink(page.url) %}is-current{% endif %}">
              <span class="eds-left-nav-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </span>
              <span class="eds-left-nav-text">Feedback Components</span>
              <span class="eds-left-nav-expand">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </span>
            </a>
            <ul class="eds-left-nav-submenu {% if '/components/feedback/' | isActiveLink(page.url) %}is-expanded{% endif %}">
              <li class="eds-left-nav-item">
                <a href="/components/feedback/alert/" class="eds-left-nav-link {% if '/components/feedback/alert/' | isActiveLink(page.url) %}is-current{% endif %}">
                  <span class="eds-left-nav-text">Alert</span>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </li>

      <li class="eds-left-nav-section">
        <span class="eds-left-nav-section-title">Resources</span>
        <ul class="eds-left-nav-section-items">
          {% for entry in navPages %}
            {% if entry.key == "Resources" %}
              {{ renderNavItem(entry, page.url) }}
            {% endif %}
          {% endfor %}
        </ul>
      </li>
    </ul>
  </div>

  <div class="eds-left-nav-footer">
    <div class="eds-theme-toggle-wrapper">
      <button id="themeToggle" class="eds-theme-toggle" aria-label="Toggle dark theme">
        <span class="eds-theme-toggle-light">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
        </span>
        <span class="eds-theme-toggle-dark">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        </span>
      </button>
      <span class="eds-theme-toggle-label">Switch theme</span>
    </div>
    <div class="eds-left-nav-version">
      <span>Version 2.0</span>
    </div>
  </div>
</nav>

<div class="eds-nav-overlay" id="navOverlay"></div>

<script>
  // Toggle navigation on mobile
  document.querySelector('.eds-left-nav-toggle').addEventListener('click', function() {
    document.body.classList.toggle('nav-open');
    const isExpanded = document.body.classList.contains('nav-open');
    this.setAttribute('aria-expanded', isExpanded);
  });

  // Toggle overlay
  document.getElementById('navOverlay').addEventListener('click', function() {
    document.body.classList.remove('nav-open');
    document.querySelector('.eds-left-nav-toggle').setAttribute('aria-expanded', 'false');
  });

  // Expand/collapse submenu
  document.querySelectorAll('.eds-left-nav-link[data-has-children="true"]').forEach(function(link) {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const listItem = this.parentElement;
      const submenu = listItem.querySelector('.eds-left-nav-submenu');
      const isExpanded = submenu.classList.contains('is-expanded');
      
      // Close other open submenus in the same level
      const siblings = listItem.parentElement.querySelectorAll('.eds-left-nav-item');
      siblings.forEach(function(sibling) {
        if (sibling !== listItem) {
          sibling.querySelector('.eds-left-nav-submenu')?.classList.remove('is-expanded');
        }
      });
      
      // Toggle current submenu
      submenu.classList.toggle('is-expanded');
      
      // If opening the submenu, navigate to the link
      if (!isExpanded) {
        setTimeout(function() {
          window.location.href = link.getAttribute('href');
        }, 300);
      }
    });
  });
</script>